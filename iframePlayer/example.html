<!DOCTYPE html>
<html lang="hk">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript" src="https://unpkg.com/@ungap/url-search-params"></script>
</head>
<body>
<div id="player-display"></div>
<script type="text/javascript">
  /**
   * 播放器
   * */
  var player;
  /**
   * Track嘅class
   * @param {String} id Track嘅編號,用來識別
   * @param {String} name Track嘅名
   * */
  function TrackDescription(id, name){
      var obj = {};
      obj.id = id;
      obj.name = name;
      return obj;
  }
  /**
   * 由HKNBP_Core開啟呢個IframePlayer去將Player播放
   * 由於因依家啲瀏覽器唔準(出聲)自動播放
   * 並且對開發程式人員講: "唔好諗住一定可以自動播放"
   * 基於此 為有增加一個按扭備不時之需讓觀眾點擊播放
   * */
  function onSetIframePlayerPlay(){

  }
  /**
   * 由HKNBP_Core開啟呢個IframePlayer去設定videoTrack
   *
   * @param {videoTrack: TrackDescription} videoTrack 當執行設定videoTrack時嘅videoTrack參數
   * */
  function onSetIframePlayerVideoTrack(videoTrack) {

  }
  /**
   * 由HKNBP_Core開啟呢個IframePlayer去獲取videoTrack
   *
   * @param {(videoTrack: TrackDescription)=>{})} onReturn 執行此CallBackFunction去return個videoTrack
   * */
  function onGetIframePlayerVideoTrack(onReturn) {

  }
  /**
   * 由HKNBP_Core開啟呢個IframePlayer去獲取所有videoTrack資訊
   *
   * @param {(videoTracks: TrackDescription[])=>{})} onReturn 執行此CallBackFunction去return所有videoTrack資訊
   * */
  function onGetIframePlayerVideoTracks(onReturn) {

  }
  /**
   * 由HKNBP_Core開啟呢個IframePlayer去設定audioTrack
   *
   * @param {audioTrack: TrackDescription} audioTrack 當執行設定audioTrack時嘅audioTrack參數
   * */
  function onSetIframePlayerAudioTrack(audioTrack) {

  }
  /**
   * 由HKNBP_Core開啟呢個IframePlayer去獲取audioTrack
   *
   * @param {(audioTrack: TrackDescription)=>{})} onReturn 執行此CallBackFunction去return個audioTrack
   * */
  function onGetIframePlayerAudioTrack(onReturn) {

  }
  /**
   * 由HKNBP_Core開啟呢個IframePlayer去獲取所有audioTrack資訊
   *
   * @param {(audioTracks: TrackDescription[])=>{})} onReturn 執行此CallBackFunction去return所有audioTrack資訊
   * */
  function onGetIframePlayerAudioTracks(onReturn) {

  }
  /**
   * 由HKNBP_Core開啟呢個IframePlayer去設定subtitleTrack
   *
   * @param {subtitleTrack: TrackDescription} subtitleTrack 當執行設定subtitleTrack時嘅subtitleTrack參數
   * */
  function onSetIframePlayerSubtitleTrack(subtitleTrack) {

  }
  /**
   * 由HKNBP_Core開啟呢個IframePlayer去獲取subtitleTrack
   *
   * @param {(subtitleTrack: TrackDescription)=>{})} onReturn 執行此CallBackFunction去return個subtitleTrack
   * */
  function onGetIframePlayerSubtitleTrack(onReturn) {

  }
  /**
   * 由HKNBP_Core開啟呢個IframePlayer去獲取所有subtitleTrack資訊
   *
   * @param {(subtitleTracks: TrackDescription[])=>{})} onReturn 執行此CallBackFunction去return所有subtitleTrack資訊
   * */
  function onGetIframePlayerSubtitleTracks(onReturn) {

  }
  /**
   * 由HKNBP_Core發出音量值讀取
   *
   * @param {volume: Number} volume 欲設音量 數值由0-100之間,100為最大音量
   * */
  function onSetIframePlayerVolume(volume) {

  }
  /**
   * 由HKNBP_Core發出音量值讀取
   *
   * @param {(volume: Number)=>{})} onReturn 執行此CallBackFunction去return現在音量 數值由0-100之間,100為最大音量
   * */
  function onGetIframePlayerVolume(onReturn) {

  }
  /**
   * 由HKNBP_Core發出靜音值讀取
   *
   * @param {muted: Boolean} muted 欲設靜音
   * */
  function onSetIframePlayerMuted(muted) {

  }
  /**
   * 由HKNBP_Core發出靜音值讀取
   *
   * @param {(muted: Boolean)=>{})} onReturn 執行此CallBackFunction去return個靜音值 靜左音(true) 或 未靜音(false)
   * */
  function onGetIframePlayerMuted(onReturn) {

  }
  /**
   * 由HKNBP_Core發出片源解像度值讀取
   *
   * @param {(resolution: Number[])=>{})} onReturn 執行此CallBackFunction去return個解像度 array[0]為寬 array[1]為高
   * */
  function onGetIframePlayerVideoResolution(onReturn){

  }
  /**
   * 由HKNBP_Core發出當觀眾按Programmable鍵
   *
   * @param {color: String} color Programmable鍵顏色
   * */
  function onClickProgrammableButton(color){

  }
  /**
   * 當播放器播放緊頻道時
   * 需要設定call呢個function()
   * 向HKNBP_Core發送呢個IframePlayer嘅播放器正播放緊頻道
   * */
  var onIframePlayerPlaying = function(){
      callHKNBPCoreFunction("onPlaying", "", function(){});
  };
  /**
   * 當播放器冇播放頻道時
   * 需要設定call呢個function()
   * 向HKNBP_Core發送呢個IframePlayer嘅播放器依家冇播放緊頻道
   * 如call左一次onIframePlayerNotPlaying()
   * 響15之內冇再call onIframePlayerPlaying()嘅話
   * 將會刷新此IframePlayer
   * */
  var onIframePlayerNotPlaying = function(){
      callHKNBPCoreFunction("onNotPlaying", "", function(){});
  };
  /**
   * 存底callHKNBPCoreFunction要求
   * 為之後return返來嘅值執行onReturn
   * 實淺CallBackFunction原理
   */
  var callHKNBPCoreFunctionList = [];
  /**
   * 刪除要刪除嘅caller響callHKNBPCoreFunctionList當中
   */
  function removeObjFromcallHKNBPCoreFunctionList(caller){
    for(var i = 0; i < callHKNBPCoreFunctionList.length; i++){
       if (callHKNBPCoreFunctionList[i] === caller) {
         callHKNBPCoreFunctionList.splice(i, 1);
       }
    }
  }
  /**
   * 設定被call時要執行嘅野
   */
  window.addEventListener("message", function(event){
      var callMessage = JSON.parse(event.data);
      if(callMessage.name === "IframePlayer"){
        for(var i = 0; i < callHKNBPCoreFunctionList.length; i++){
           if (callHKNBPCoreFunctionList[i].id == callMessage.id) {
             callHKNBPCoreFunctionList[i].onReturn(callMessage.returnValue)
             removeObjFromcallHKNBPCoreFunctionList(callHKNBPCoreFunctionList[i]);
           }
        }
      }else if(callMessage.name === "HKNBPCore"){
        var onReturn = function(returnValue){
            var obj = callMessage;
            obj.returnValue = returnValue;
            window.parent.postMessage(JSON.stringify(obj), "*");
        }
        eval(callMessage.evalScript);
      }
  }, false);
  /**
   * 去call HKNBPCore嘅Function
   */
  function callHKNBPCoreFunction(functionName, value, onReturn){
      var caller = {};
      caller.functionName = functionName;
      caller.value = value;
      caller.name = "IframePlayer";
      caller.id = new Date().getTime().toString() + Math.random().toString();
      caller.onReturn = onReturn;
      callHKNBPCoreFunctionList.push(caller);
      window.setTimeout(function(){
        removeObjFromcallHKNBPCoreFunctionList(caller); //如果太耐冇return就響List自動清除免堆垃圾
      }, 60000);
      window.parent.postMessage(JSON.stringify(caller), "*");
  }
  /**
   * 由HKNBP_Core發出初始化IframePlayer
   *
   * @param {source: String} source 頻道源
   * */
  function onIframePlayerInit(sourceSrc){

  }
  /**
   * 在URL參數讀取 片源
   * 並初始化IframePlayer
   */
  onIframePlayerInit(decodeURIComponent(new URL(window.location.href).searchParams.get("sourceSrc")));
</script>
</body>
</html>
